<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pong â€” Ø¨Ø§Ø²ÛŒ Ù¾ÛŒÙ†Ú¯â€ŒÙ¾Ù†Ú¯</title>
<style>
  :root{
    --bg:#071026;
    --panel:#0b1630;
    --accent:#1fb6ff;
    --muted:rgba(255,255,255,0.08);
    --text:#e6f7ff;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto;background:linear-gradient(180deg,var(--bg),#02040b);color:var(--text);-webkit-tap-highlight-color:transparent;}
  .wrap{display:grid;grid-template-rows:auto 1fr auto;min-height:100vh;gap:12px;padding:14px;}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between}
  h1{font-size:18px;margin:0}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:var(--panel);border:1px solid var(--muted);color:var(--text);padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer}
  button.ghost{background:transparent}
  .small{padding:6px 8px;font-size:13px}
  .row{display:flex;gap:8px;align-items:center}
  .game-area{position:relative;display:flex;align-items:center;justify-content:center;border-radius:10px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03)}
  canvas{width:100%;height:calc(100vh - 180px);display:block;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent 30%);touch-action:none}
  footer{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .label{opacity:.85;font-size:13px}
  select,input[type=range]{background:var(--panel);border:1px solid var(--muted);color:var(--text);padding:6px;border-radius:6px}
  .hud{display:flex;gap:12px;align-items:center;font-weight:700;font-size:20px}
  .notice{position:absolute;left:50%;top:12px;transform:translateX(-50%);background:rgba(0,0,0,0.3);backdrop-filter: blur(4px);padding:6px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.04)}
  /* touch hint halves */
  .touch-hint{position:absolute;inset:0;pointer-events:none;display:flex}
  .touch-hint > div{flex:1;border-left:1px dashed rgba(255,255,255,0.02)}
  .settings{display:flex;gap:8px;align-items:center}
  .center-note{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;pointer-events:none;color:rgba(255,255,255,0.06);font-size:120px;font-weight:900;letter-spacing:18px}
  @media (max-width:700px){
    canvas{height:calc(100vh - 220px)}
    .center-note{font-size:60px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Pong â€” Ø¨Ø§Ø²ÛŒ</h1>
      <div class="controls">
        <div class="panel row">
          <label class="label" for="mode">Ø­Ø§Ù„Øª:</label>
          <select id="mode" title="Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ">
            <option value="single">ØªÚ©â€ŒÙ†ÙØ±Ù‡ (Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ AI)</option>
            <option value="local">Ø¯Ùˆâ€ŒÙ†ÙØ±Ù‡ Ù…Ø­Ù„ÛŒ</option>
          </select>
        </div>

        <div class="panel row">
          <label class="label" for="difficulty">Ø³Ø®ØªÛŒ:</label>
          <select id="difficulty">
            <option value="0.25">Ø¢Ø³Ø§Ù†</option>
            <option value="0.5" selected>Ù…ØªÙˆØ³Ø·</option>
            <option value="0.85">Ø³Ø®Øª</option>
          </select>
        </div>

        <button id="startBtn">Ø´Ø±ÙˆØ¹</button>
        <button id="pauseBtn" class="ghost small">ØªÙˆÙ‚Ù</button>
        <button id="resetBtn" class="small ghost">Ø±ÛŒØ³Øª</button>
        <button id="muteBtn" class="small">ğŸ”Š</button>
      </div>
    </header>

    <main class="game-area panel" id="gameWrap">
      <div class="notice" id="notice">Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª: Ù„Ù…Ø³ ÛŒØ§ Ú©Ø´ÛŒØ¯Ù† / W/S Ùˆ â†‘/â†“</div>
      <div class="touch-hint"><div></div><div></div></div>
      <canvas id="canvas"></canvas>
      <div class="center-note" id="endMark" style="display:none">GAME</div>
    </main>

    <footer>
      <div class="hud panel">
        <div>Ø¨Ø§Ø²ÛŒÚ©Ù† Ú†Ù¾: <span id="scoreL">0</span></div>
        <div style="width:14px"></div>
        <div>Ø¨Ø§Ø²ÛŒÚ©Ù† Ø±Ø§Ø³Øª: <span id="scoreR">0</span></div>
      </div>
      <div class="panel row settings">
        <label class="label">ØªØ§ Ù†Ù…Ø±Ù‡:</label>
        <select id="scoreTo">
          <option value="3">3</option>
          <option value="5">5</option>
          <option value="7" selected>7</option>
          <option value="11">11</option>
        </select>
        <div style="width:8px"></div>
        <div class="label">Ù†Ø³Ø®Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„: Ù„Ù…Ø³ Ù†ÛŒÙ…Ù‡ ØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„</div>
      </div>
    </footer>
  </div>

<script>
/* --------- Ø¨Ø§Ø²ÛŒ Pong Ø¯Ø± ÛŒÚ© ÙØ§ÛŒÙ„ --------- */
/* Ø³Ø±ÛŒØ¹: Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ Ú©Ø§ÙÛŒ Ùˆ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ/Ú©ÛŒØ¨ÙˆØ±Ø¯ */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W=0,H=0;

function resize(){
  W = canvas.width = canvas.clientWidth = window.innerWidth - 40; // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø§Ø¯Ù‡
  H = canvas.height = canvas.clientHeight = Math.max(300, window.innerHeight - 220);
}
window.addEventListener('resize', () => { resize(); });

resize();

/* Ø¨Ø§Ø²ÛŒ */
let running = false, paused=false;
let scoreL = 0, scoreR = 0;
const scoreLEl = document.getElementById('scoreL');
const scoreREl = document.getElementById('scoreR');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');
const muteBtn = document.getElementById('muteBtn');
const modeSelect = document.getElementById('mode');
const difficultySel = document.getElementById('difficulty');
const scoreToSel = document.getElementById('scoreTo');
const notice = document.getElementById('notice');
const endMark = document.getElementById('endMark');

let soundOn = true;

/* WebAudio Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØµØ¯Ø§ */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
function beep(freq=200, duration=0.06, gain=0.08){
  if(!soundOn) return;
  if(!audioCtx) audioCtx = new AudioCtx();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type='sine';
  o.frequency.value = freq;
  g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + duration);
}

/* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ Ùˆ Ø§Ø´ÛŒØ§Ø¡ */
const PADDLE_W = 14;
let PADDLE_H = 80; // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± resize
const PADDLE_SPEED = 8;

const ball = {
  x: W/2,
  y: H/2,
  vx: 0,
  vy: 0,
  r: 8,
  speed: 6
};

const left = { x: 30, y: H/2, vy:0 };
const right = { x: W-30, y: H/2, vy:0 };

/* Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯ */
function resetBall(servesToRight = Math.random() > 0.5) {
  ball.x = W/2;
  ball.y = H/2;
  ball.speed = Math.max(5, Math.min(10, (parseInt(scoreToSel.value)||7) / 2 + 5));
  let ang = (Math.random() * Math.PI/3) - Math.PI/6; // Â±30deg
  ball.vx = (servesToRight ? 1 : -1) * ball.speed * Math.cos(ang);
  ball.vy = ball.speed * Math.sin(ang);
}

function resetGame(){
  scoreL = scoreR = 0;
  updateScore();
  resetBall();
  running = false;
  paused = false;
  endMark.style.display = 'none';
  notice.textContent = 'Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª: Ù„Ù…Ø³ ÛŒØ§ Ú©Ø´ÛŒØ¯Ù† / W/S Ùˆ â†‘/â†“';
}

/* Ø±Ø§Ù† Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒ */
let lastTime = 0;
function loop(ts){
  if(!running || paused){ lastTime = ts; requestAnimationFrame(loop); return; }
  const dt = Math.min(40, ts - lastTime) / 16.666; // ØªÙ‚Ø±ÛŒØ¨ Ø¨Ù‡ ÙØ±ÛŒÙ… 60
  lastTime = ts;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

/* Ø¨Ù‡â€ŒØ±ÙˆØ²â€ŒØ±Ø³Ø§Ù†ÛŒ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ */
function update(dt){
  // Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù¾Ø¯Ø§Ù„â€ŒÙ‡Ø§ Ù…ØªÙ†Ø§Ø³Ø¨ ØµÙØ­Ù‡
  PADDLE_H = Math.max(48, Math.min(160, H * 0.18));

  // Ø­Ø±Ú©Øª Ù¾Ø¯Ø§Ù„â€ŒÙ‡Ø§: left.y, right.y Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´Ù‡ ØªÙˆØ³Ø· ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ ÛŒØ§ AI
  left.y += left.vy * PADDLE_SPEED * dt;
  right.y += right.vy * PADDLE_SPEED * dt;

  // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø®Ù„ ØµÙØ­Ù‡
  left.y = Math.max(PADDLE_H/2, Math.min(H - PADDLE_H/2, left.y));
  right.y = Math.max(PADDLE_H/2, Math.min(H - PADDLE_H/2, right.y));

  // Ø­Ø±Ú©Øª ØªÙˆÙ¾
  ball.x += ball.vx * dt;
  ball.y += ball.vy * dt;

  // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø¨Ø§Ù„Ø§/Ù¾Ø§ÛŒÛŒÙ†
  if(ball.y - ball.r < 0){ ball.y = ball.r; ball.vy *= -1; beep(300); }
  if(ball.y + ball.r > H){ ball.y = H - ball.r; ball.vy *= -1; beep(300); }

  // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ù¾Ø¯Ø§Ù„ Ú†Ù¾
  if(ball.x - ball.r < left.x + PADDLE_W/2){
    if(Math.abs(ball.y - left.y) < PADDLE_H/2 + ball.r){
      // Ø¨Ø±Ø®ÙˆØ±Ø¯
      ball.x = left.x + PADDLE_W/2 + ball.r;
      reflectFromPaddle(left);
      beep(520);
    } else {
      // Ú¯Ù„ Ø±Ø§Ø³Øª
      scoreR++;
      updateScore();
      beep(120,0.12,0.14);
      checkEnd();
      resetBall(true);
    }
  }

  // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ù¾Ø¯Ø§Ù„ Ø±Ø§Ø³Øª
  if(ball.x + ball.r > right.x - PADDLE_W/2){
    if(Math.abs(ball.y - right.y) < PADDLE_H/2 + ball.r){
      ball.x = right.x - PADDLE_W/2 - ball.r;
      reflectFromPaddle(right);
      beep(520);
    } else {
      // Ú¯Ù„ Ú†Ù¾
      scoreL++;
      updateScore();
      beep(120,0.12,0.14);
      checkEnd();
      resetBall(false);
    }
  }

  // Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (Ø¯Ø± Ø­Ø§Ù„Øª ØªÚ©â€ŒÙ†ÙØ±Ù‡)
  if(modeSelect.value === 'single'){
    const diff = parseFloat(difficultySel.value) || 0.5;
    // Ø±Ø§Ø³Øª: AI
    let targetY = ball.y + (Math.random()*120 - 60) * (1 - diff); // Ø®Ø·Ø§ Ù¾Ù†Ù‡Ø§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø®ØªÛŒ
    // Ø³Ø§Ø¯Ù‡: Ø­Ø±Ú©Øª Ø¨Ù‡ Ø³Ù…Øª Ù‡Ø¯Ù
    if(Math.abs(right.y - targetY) > 6) right.vy = (right.y < targetY) ? 1 * diff*1.8 : -1 * diff*1.8;
    else right.vy = 0;
    // Ú†Ù¾: Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù†ÛŒØ³ØªØŒ Ú©Ù…ÛŒ Ø±Ù†Ø¯ÙˆÙ… Ø­Ø±Ú©Øª Ú©Ù†Ø¯
    if(!inputState.leftActive && modeSelect.value !== 'local') {
      // Ø¢Ø±Ø§Ù… Ú¯Ø´Øª Ø²Ù†ÛŒ
      left.vy = Math.sign(Math.sin(Date.now()/1000 + 0.5)) * 0.25;
    }
  } else {
    // Ø¯Ø± Ø­Ø§Ù„Øª local: Ù‡ÛŒÚ† AI Ø¨Ø±Ø§ÛŒ Ù¾Ø¯Ø§Ù„â€ŒÙ‡Ø§
    // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù„Ù…Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†ÛŒÙ…Ù‡ Ú©Ù†ØªØ±Ù„ Ú©Ù†Ø¯ØŒ input Ù‡Ø§ Ø³Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
    if(!inputState.leftActive) left.vy = 0;
    if(!inputState.rightActive) right.vy = 0;
  }
}

/* Ø¨Ø§Ø²ØªØ§Ø¨ ØªÙˆÙ¾ Ø§Ø² Ø±ÙˆÛŒ Ù¾Ø¯Ø§Ù„ */
function reflectFromPaddle(pad){
  // ÙØ§ØµÙ„Ù‡ Ø¹Ù…ÙˆØ¯ÛŒ Ø§Ø² Ù…Ø±Ú©Ø² Ù¾Ø¯Ø§Ù„
  let relative = (ball.y - pad.y) / (PADDLE_H/2);
  relative = Math.max(-1, Math.min(1, relative));
  // Ø²Ø§ÙˆÛŒÙ‡ Ø¨Ø§Ø²ØªØ§Ø¨ Ø§Ø² -60 ØªØ§ 60 Ø¯Ø±Ø¬Ù‡
  const maxAng = Math.PI*0.45;
  const ang = relative * maxAng;
  const speedUp = 1.06; // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª Ù‡Ø± Ø¨Ø±Ø®ÙˆØ±Ø¯
  ball.speed = Math.min(18, ball.speed * speedUp);
  // Ø¬Ù‡Øª vx Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø¯Ø§Ù… Ù¾Ø¯Ø§Ù„ Ø§Ø³Øª
  const dir = (pad === left) ? 1 : -1;
  ball.vx = dir * ball.speed * Math.cos(ang);
  ball.vy = ball.speed * Math.sin(ang);
}

/* Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø±ÙˆÛŒ ØµÙØ­Ù‡ */
function updateScore(){
  scoreLEl.textContent = scoreL;
  scoreREl.textContent = scoreR;
}

/* Ú†Ú© Ø§Ù†ØªÙ‡Ø§ */
function checkEnd(){
  const to = parseInt(scoreToSel.value) || 7;
  if(scoreL >= to || scoreR >= to){
    running = false;
    endMark.style.display = 'block';
    endMark.textContent = scoreL>scoreR ? 'PLAYER LEFT WON' : 'PLAYER RIGHT WON';
    notice.textContent = 'ØªÙ…Ø§Ù… Ø´Ø¯ â€” Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡';
    beep(220,0.25,0.16);
  }
}

/* Ø±Ø³Ù… */
function draw(){
  // Ø²Ù…ÛŒÙ†Ù‡
  ctx.clearRect(0,0,W,H);
  // ÙØ¶Ø§ÛŒ Ø¨Ø§Ø²ÛŒ (Ø³Ø¨Ú© Ø´Ø¨)
  ctx.fillStyle = 'rgba(0,0,0,0.25)';
  ctx.fillRect(0,0,W,H);

  // Ø®Ø·ÙˆØ· Ù…ÛŒØ§Ù†ÛŒ
  ctx.strokeStyle = 'rgba(255,255,255,0.06)';
  ctx.lineWidth = 2;
  ctx.setLineDash([8,12]);
  ctx.beginPath();
  ctx.moveTo(W/2,0); ctx.lineTo(W/2,H); ctx.stroke();
  ctx.setLineDash([]);

  // Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ Ú©ÙˆÚ†Ú© Ø¯Ø± notice (already UI)
  // Ù¾Ø¯Ø§Ù„â€ŒÙ‡Ø§
  ctx.fillStyle = '#fff';
  // left
  roundRect(ctx, left.x - PADDLE_W/2, left.y - PADDLE_H/2, PADDLE_W, PADDLE_H, 6);
  // right
  roundRect(ctx, right.x - PADDLE_W/2, right.y - PADDLE_H/2, PADDLE_W, PADDLE_H, 6);

  // ØªÙˆÙ¾
  ctx.beginPath();
  ctx.fillStyle = '#ffd';
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
  ctx.fill();

  // Ù†ÙˆØ±Ù Ù…Ù„Ø§ÛŒÙ… Ø§Ø·Ø±Ø§Ù ØªÙˆÙ¾ (glow)
  const g = ctx.createRadialGradient(ball.x, ball.y, 0, ball.x, ball.y, ball.r*6);
  g.addColorStop(0, 'rgba(31,182,255,0.12)');
  g.addColorStop(1, 'rgba(31,182,255,0)');
  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r*6, 0, Math.PI*2);
  ctx.fill();
}

/* helper: rounded rectangles */
function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  ctx.fill();
}

/* ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§: Ú©ÛŒØ¨ÙˆØ±Ø¯ */
const keys = {};
window.addEventListener('keydown', e=>{
  keys[e.key.toLowerCase()] = true;
  inputFromKeys();
});
window.addEventListener('keyup', e=>{
  keys[e.key.toLowerCase()] = false;
  inputFromKeys();
});

function inputFromKeys(){
  // W/S Ø¨Ø±Ø§ÛŒ Ú†Ù¾ ØŒ ArrowUp/ArrowDown Ø¨Ø±Ø§ÛŒ Ø±Ø§Ø³Øª
  if(modeSelect.value === 'local'){
    left.vy = (keys['w']? -1 : (keys['s']? 1 : 0));
    right.vy = (keys['arrowup']? -1 : (keys['arrowdown']? 1 : 0));
  } else {
    // ØªÚ©â€ŒÙ†ÙØ±Ù‡: Ú©Ø§Ø±Ø¨Ø± Ú†Ù¾ Ø¨Ø§ Ú©ÛŒØ¨ÙˆØ±Ø¯ Ú©Ù†ØªØ±Ù„ Ú©Ù†Ø¯
    left.vy = (keys['w']? -1 : (keys['s']? 1 : 0));
  }
}

/* ÙˆØ±ÙˆØ¯ÛŒ Ù„Ù…Ø³ÛŒ / Ù…ÙˆØ³: Ù†ÛŒÙ…â€ŒØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¨Ø§Ø²ÛŒÚ©Ù† */
const inputState = {
  leftActive: false,
  rightActive: false,
  touches: {}
};

function handlePointer(e){
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX ?? (e.touches? e.touches[0].clientX : 0)) - rect.left;
  const y = (e.clientY ?? (e.touches? e.touches[0].clientY : 0)) - rect.top;
  // ØªØ¹ÛŒÛŒÙ† Ù†ÛŒÙ…Ù‡ ØµÙØ­Ù‡
  if(modeSelect.value === 'local'){
    if(x < rect.width/2){
      left.y = y;
      inputState.leftActive = true;
    } else {
      right.y = y;
      inputState.rightActive = true;
    }
  } else {
    // ØªÚ©â€ŒÙ†ÙØ±Ù‡: Ù„Ù…Ø³ÛŒ Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù† Ú†Ù¾
    left.y = y;
    inputState.leftActive = true;
    // Ù‡Ù†Ú¯Ø§Ù… Ù„Ù…Ø³: Ù†Ø²Ø¯ÛŒÚ© Ú©Ù†Ø´ AI (Ù‡Ø± Ø¯Ùˆ Ø¨Ù‡ Ø¢Ù† Ù†Ù‚Ø·Ù‡ Ù†Ø²Ø¯ÛŒÚ© Ø¨Ø´Ù†) â€” Ø¯Ø³ØªÙˆØ± Ú©Ø§Ø±Ø¨Ø±
    // Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§ÛŒÙ†ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… ØªÙˆÙ¾/Ù…Ø±Ú©Ø² Ø±Ø§ Ø¨Ù‡ Ø¢Ù† Ø³Ù…Øª Ø³ÙˆÙ‚ Ø¯Ù‡ÛŒÙ…Ø› Ø§Ù…Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø¯Ø§Ø´ØªÛŒ Ú©Ù‡ ÙˆÙ‚ØªÛŒ ØªØ§Ú† Ú©Ø±Ø¯ÛŒ Ø¯ÙˆØªØ§ Ù†Ø²Ø¯ÛŒÚ© Ù‡Ù… Ø¨Ø§Ø´Ù†
    // Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ù†: ÙˆÙ‚ØªÛŒ pointerdownØŒ Ù…Ø§ Ø¯Ùˆ Ù¾Ø¯Ø§Ù„ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… ØªØ§ Ù†Ø²Ø¯ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø¨Ø§Ø´Ù†Ø¯
  }
}

canvas.addEventListener('pointerdown', e=>{
  e.preventDefault();
  handlePointer(e);
  // Ù‡Ù†Ú¯Ø§Ù… downØŒ Ø§Ú¯Ø± ØªÚ©â€ŒÙ†ÙØ±Ù‡ØŒ Ù†Ø²Ø¯ÛŒÚ© Ú©Ù† Ø¯Ùˆ Ù¾Ø¯Ø§Ù„ Ø¨Ù‡ Ù†Ù‚Ø·Ù‡ Ù„Ù…Ø³ Ø´Ø¯Ù‡
  if(modeSelect.value === 'single'){
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    // Ù‡Ø± Ø¯Ùˆ Ù¾Ø¯Ø§Ù„ Ø¨Ù‡ Ø³Ù…Øª y Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ (Ù‚Ø±ÛŒØ¨)
    left.y = y;
    right.y = y;
    inputState.leftActive = true;
    inputState.rightActive = true;
    notice.textContent = 'Ù„Ù…Ø³ Ø´Ø¯ â€” Ù¾Ø¯Ø§Ù„â€ŒÙ‡Ø§ Ù†Ø²Ø¯ÛŒÚ© Ø´Ø¯Ù†Ø¯';
    setTimeout(()=>{ notice.textContent = 'Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª: Ù„Ù…Ø³ ÛŒØ§ Ú©Ø´ÛŒØ¯Ù† / W/S Ùˆ â†‘/â†“'; inputState.rightActive = false; }, 600);
  }
});

canvas.addEventListener('pointermove', e=>{
  e.preventDefault();
  handlePointer(e);
});

canvas.addEventListener('pointerup', e=>{
  e.preventDefault();
  inputState.leftActive = false;
  inputState.rightActive = false;
});

canvas.addEventListener('touchmove', e=>{
  e.preventDefault();
  const rect = canvas.getBoundingClientRect();
  // Ø¯Ø± ØµÙˆØ±Øª Ú†Ù†Ø¯ Ù„Ù…Ø³ØŒ Ù‡Ø± Ù„Ù…Ø³ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†
  for(let i=0;i<e.touches.length;i++){
    const t = e.touches[i];
    const x = t.clientX - rect.left;
    const y = t.clientY - rect.top;
    if(x < rect.width/2){
      left.y = y;
      inputState.leftActive = true;
    } else {
      right.y = y;
      inputState.rightActive = true;
    }
  }
}, { passive:false });

window.addEventListener('touchend', e=>{
  // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ù„Ù…Ø³ÛŒ Ù†Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
  if((e.touches && e.touches.length===0) || !e.touches) {
    inputState.leftActive = false;
    inputState.rightActive = false;
  }
});

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
startBtn.addEventListener('click', () => {
  if(!running){
    running = true;
    paused = false;
    lastTime = performance.now();
    resetBall();
    requestAnimationFrame(loop);
    notice.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒ...';
  } else {
    // restart mid-game
    scoreL = scoreR = 0;
    updateScore();
    resetBall();
    notice.textContent = 'Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯';
  }
});
pauseBtn.addEventListener('click', () => {
  paused = !paused;
  pauseBtn.textContent = paused ? 'Ø§Ø¯Ø§Ù…Ù‡' : 'ØªÙˆÙ‚Ù';
  notice.textContent = paused ? 'Ù…ØªÙˆÙ‚Ù Ø´Ø¯' : 'Ø§Ø¯Ø§Ù…Ù‡';
});
resetBtn.addEventListener('click', () => { resetGame(); });
muteBtn.addEventListener('click', ()=>{
  soundOn = !soundOn;
  muteBtn.textContent = soundOn ? 'ğŸ”Š' : 'ğŸ”‡';
});

/* Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡ */
resetGame();

/* Ú©Ù„ÛŒØ¯ Ù…ÛŒØ§Ù†Ø¨Ø±: ÙØ¶Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹/ØªÙˆÙ‚Ù */
window.addEventListener('keydown', (e)=>{
  if(e.code === 'Space'){ e.preventDefault(); if(!running) startBtn.click(); else pauseBtn.click(); }
});

/* Ø±ÙØªØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯: ÙˆÙ‚ØªÛŒ Ø¯Ø± Ø­Ø§Ù„Øª single Ùˆ Ú©Ø§Ø±Ø¨Ø± ØªØ§Ú† Ú©Ø±Ø¯ØŒ Ù¾Ø¯Ø§Ù„â€ŒÙ‡Ø§ Ù†Ø²Ø¯ÛŒÚ© Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
   Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± pointerdown Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ø› Ø§Ú¯Ø± Ø¨Ø®ÙˆØ§Ù‡ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ø²Ù…Ø§Ù† Ùˆ Ù†Ø­ÙˆÙ‡ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒÙ…. */

/* Ø¯Ø± Ù†Ù‡Ø§ÛŒØª: Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ù†Ø¯Ø± (Ø¨Ø¯ÙˆÙ† Ø´Ø±ÙˆØ¹) */
draw();

/* Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ ÛŒØ§ Ø²ÙˆÙ… Ø®ÙˆØ§Ø³ØªØŒ touch-action:none ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡Ø› Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø®ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù„Ø§Ø²Ù… Ø¨Ø§Ø´Ø¯ gesture handling */
</script>
</body>
</html>
